---
id: section-03
title: Ignite React.js · Chapter 04 · Section 03
sidebar_label: Section 03
description: Ignite React.js by RocketSeat.
keywords:
  - Alex Bleggi
image: /static/other/img/profile.png
slug: /ignite/react-js/course/chapter-04/section-03
toc_max_heading_level: 4
hide_title: true
---

import useBaseUrl from "@docusaurus/useBaseUrl";

# Pagamentos no Stripe

## [Gerando sessão de checkout](https://app.rocketseat.com.br/node/back-end-no-front-end/group/pagamentos-no-stripe/lesson/gerando-sessao-de-checkout)

```typescript {1,8,9,10,11,14,16-21,27} title="src/components/SubscribeButton/index.tsx"
import { useSession, signIn } from 'next-auth/react';
import styles from './styles.module.scss';

interface SubscribeButtonProps {
  priceId: string;
}

// 3 lugares no next que fazem operações com segurança(credenciais):
// getServerSideProps (SSR)
// getStaticProps (SSG)
// API routes

export function SubscribeButton({ priceId }: SubscribeButtonProps) {
  const [session] = useSession();

  function handleSubscribe() {
    if(!session) {
      signIn('github');
      return;
    }
  }

  return (
    <button
      className={styles.subscribeButton}
      type="button"
      onClick={handleSubscribe}>
      Subscribe now
    </button>
  );
}

```

```typescript {1-31 title="src/pages/api/subscribe.ts"
import { NextApiRequest, NextApiResponse } from "next";
import { getSession } from 'next-auth/react'
import { stripe } from '../../services/stripe';

export default async(req: NextApiRequest, res: NextApiResponse) => {
  if(req.method === 'POST') {
    const session = await getSession({ req });

    const stripeCustomer = await stripe.customers.create({
      email: session.user.email,
    });

    const stripeCheckoutSession = await stripe.checkout.sessions.create({
      customer: stripeCustomer.id,
      payment_method_types: ['card'],
      billing_address_collection: 'required',
      line_items: [
        { price: 'price_1KlVTIIYWJkapL3ipt4RuopL', quantity: 1 }
      ],
      mode: 'subscription',
      allow_promotion_codes: true,
      success_url: process.env.STRIPE_SUCCESS_URL,
      cancel_url: process.env.STRIPE_CANCEL_URL
    })

    return res.status(200).json({ sessionId: stripeCheckoutSession.id });
  } else {
    res.setHeader('Allow', 'POST');
    res.status(405).end('Method not allowed');
  }
}
```

```txt {3,4} title=".env.local"
# Stripe
STRIPE_API_KEY=...
STRIPE_SUCCESS_URL=...
STRIPE_CANCEL_URL=...

# Github
GITHUB_ID=...
GITHUB_SECRET=...

# FaunaDB
FAUNADB_KEY=...
```

## [Redirecionando para o Stripe](https://app.rocketseat.com.br/node/back-end-no-front-end/group/pagamentos-no-stripe/lesson/gerando-sessao-de-checkout)

```bash
# npm
npm i axios

# yarn
yarn add axios
```
