---
id: section-04
title: Ignite Node.js · 2023 · Chapter 01 · Section 04
sidebar_label: Section 04
description: Ignite Node.js by RocketSeat.
keywords:
  - Alex Bleggi
image: /static/other/img/profile.png
slug: /ignite/node-js/course/2023/chapter-01/section-04
toc_max_heading_level: 4
hide_title: true
---

import useBaseUrl from '@docusaurus/useBaseUrl';

# Banco de dados

## [Criando banco de dados JSON](https://app.rocketseat.com.br/node/projeto-01-1/group/streams-no-node-js/lesson/entendendo-streams-no-node)

```javascript title="src/database.js"
export class Database {
  #database = {};

  select(table) {
    const data = this.#database[table] ?? [];
    return data;
  }

  insert(table, data) {
    // se já existe um array 'table' na tabela 'database'
    if (Array.isArray(this.#database[table])) {
      this.#database[table].push(data);
    } else {
      this.#database[table] = [data];
    }

    return data;
  }
}
```

```javascript {2,5,13,15,21,27,29} title="src/server.js"
import http from 'node:http';
import { Database } from './database.js';
import { json } from './middlewares/json.js';

const database = new Database();

const server = http.createServer(async (req, res) => {
  const { method, url } = req;

  await json(req, res);

  if (method === 'GET' && url === '/users') {
    const users = database.select('users');

    return res.end(JSON.stringify(users));
  }

  if (method === 'POST' && url === '/users') {
    const { name, email } = req.body;

    const users = {
      id: 1,
      name,
      email,
    };

    database.insert('users', users);

    return res.writeHead(201).end();
  }

  return res.writeHead(404).end();
});

server.listen(3333);
```

## [Persistindo banco de dados](https://app.rocketseat.com.br/node/projeto-01-1/group/banco-de-dados-1/lesson/persistindo-banco-de-dados)

```javascript {1,3,8-17,19-21,36} title="src/database.js"
import fs from 'node:fs/promises';

const databasePath = new URL('../db.json', import.meta.url);

export class Database {
  #database = {};

  constructor() {
    fs.readFile(databasePath, 'utf8')
      .then((data) => {
        this.#database = JSON.parse(data);
      })
      .catch(() => {
        // se não existir o arquivo, ele será criado
        this.#persist();
      });
  }

  #persist() {
    fs.writeFile(databasePath, JSON.stringify(this.#database));
  }

  select(table) {
    const data = this.#database[table] ?? [];
    return data;
  }

  insert(table, data) {
    // se já existe um array 'table' na tabela 'database'
    if (Array.isArray(this.#database[table])) {
      this.#database[table].push(data);
    } else {
      this.#database[table] = [data];
    }

    this.#persist();

    return data;
  }
}
```

## [Criando ID único e universal (UUID)](https://app.rocketseat.com.br/node/projeto-01-1/group/banco-de-dados-1/lesson/criando-id-unico-e-universal-uuid)

```javascript {2,23} title="src/server.js"
import http from 'node:http';
import { randomUUID } from 'node:crypto';
import { Database } from './database.js';
import { json } from './middlewares/json.js';

const database = new Database();

const server = http.createServer(async (req, res) => {
  const { method, url } = req;

  await json(req, res);

  if (method === 'GET' && url === '/users') {
    const users = database.select('users');

    return res.end(JSON.stringify(users));
  }

  if (method === 'POST' && url === '/users') {
    const { name, email } = req.body;

    const users = {
      id: randomUUID(),
      name,
      email,
    };

    database.insert('users', users);

    return res.writeHead(201).end();
  }

  return res.writeHead(404).end();
});

server.listen(3333);
```
